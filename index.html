# Build an English-only LLaVA-style site that embeds the user's six result PDFs at paths:
# pdf/jpeg10_web1_225.pdf, pdf/jpeg10_web1_258.pdf, pdf/jpeg10_web1_265.pdf,
# pdf/jpeg10_web1_294.pdf, pdf/jpeg10_web1_297.pdf, pdf/jpeg10_web1_298.pdf

import os, zipfile, re, textwrap, shutil

root = "/mnt/data/c-relic-llava-style-pdf-en"
if os.path.exists(root):
    shutil.rmtree(root)
os.makedirs(os.path.join(root, "assets", "css"), exist_ok=True)
os.makedirs(os.path.join(root, "pdf"), exist_ok=True)
open(os.path.join(root, ".nojekyll"), "w").write("")

# Minimal clean CSS (English-only labels)
css = """
:root{--line:#e5e7eb;--muted:#4b5563}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;color:#111}
a{color:#2563eb;text-decoration:none}a:hover{text-decoration:underline}
.container{max-width:980px;margin:0 auto;padding:0 16px}
.topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:50}
.nav{display:flex;justify-content:space-between;align-items:center;height:64px}
.brand{font-weight:800}
.section{padding:36px 0}
.card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px}
.table-wrap{overflow-x:auto;border:1px solid var(--line);border-radius:12px;background:#fff}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border-top:1px solid var(--line);padding:8px;white-space:nowrap}
thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--line)}
.center{text-align:center}
.best{color:#dc2626;font-weight:800}
.second{color:#1e40af;text-decoration:underline;font-weight:700}
.pdf-embed{width:100%;height:360px;border:1px solid var(--line);border-radius:8px}
.pdf-embed.small{height:280px}
.pdf-fallback{font-size:12px;color:var(--muted)}
.footer{border-top:1px solid var(--line);padding:28px 0;color:var(--muted);text-align:center}
"""
open(os.path.join(root, "assets", "css", "site.css"), "w").write(css)

title = "Decomposing the Latent Space: A Phase-aware Plug-and-Play Approach for Universal Compressed Image Restoration"
abstract_tex = r"""Universal compressed image restoration (CIR) aims to recover high-quality images from lossy compressed inputs using a single model that generalizes across diverse codecs. While recent diffusion-based methods have shown promise, they often rely on task-specific tuning and pixel-space decoding, limiting flexibility and robustness. In this paper, we propose a phase-aware and plug-and-play framework for universal CIR, termed C-ReLIC (\textbf{C}ompression \textbf{Re}storation with \textbf{L}atent \textbf{I}nvertible \textbf{C}onsistency). At its core is the Bidirectional Latent-Operator Consistency (Bi-LOC) block, a novel mechanism that factorizes latent features into measurement and detail components via an invertible operator, enabling bidirectional consistency for both fidelity and detail preservation. To further enhance quality, our algorithm adopts a phase-aware strategy that anchors the early phase of reverse diffusion to global structure and refines perceptual quality in the late phase. Experiments show that C-ReLIC achieves state-of-the-art perceptual performance across diverse codecs, offering a superior distortion–perception trade-off."""
abstract_html = re.sub(r"\\textbf\{(.*?)\}", r"<strong>\1</strong>", abstract_tex)

def best(x): return '<span class="best">'+x+'</span>'
def second(x): return '<span class="second">'+x+'</span>'
def row(c,m,v,psnr,lpips,dists,fid,niqe,musiq,cl):
    return f"<tr><td class='center'>{c}</td><td>{m}</td><td>{v}</td><td class='center'>{psnr}</td><td class='center'>{lpips}</td><td class='center'>{dists}</td><td class='center'>{fid}</td><td class='center'>{niqe}</td><td class='center'>{musiq}</td><td class='center'>{cl}</td></tr>"

tbody = ""
# JPEG
tbody += row("JPEG","SwinIR","ICCV'21", second("30.09"), "0.4746", "0.2640", "117.20", "8.1017", "50.25", "0.3127")
tbody += row("JPEG","PASD","ICCV'23", "29.22", "0.5905", "0.3115", "134.57", "5.0570", "49.56", "0.2272")
tbody += row("JPEG","DiffBIR","ECCV'24", "28.28", "0.6896", "0.3653", "140.95", "6.3628", "33.84", "0.2480")
tbody += row("JPEG","SILO","ICCV'25", "25.89", "0.4261", second("0.2012"), second("67.46"), "5.9229", second("55.51"), second("0.4485"))
tbody += row("JPEG","Moe-DiffIR","ECCV'24", best("30.52"), second("0.4171"), "0.2057", "78.62", best("4.7938"), "53.76", "0.4046")
tbody += row("JPEG","Ours","--", "26.15", best("0.3941"), best("0.1735"), best("64.12"), second("5.0502"), best("72.26"), best("0.6271"))
# HEVC
tbody += row("HEVC","SwinIR","ICCV'21", best("30.68"), "0.4179", "0.2393", "105.29", "8.0999", "51.85", "0.3536")
tbody += row("HEVC","PASD","ICCV'23", "29.97", "0.3600", "0.1618", "67.17", "5.3200", "70.81", "0.5463")
tbody += row("HEVC","DiffBIR","ECCV'24", "28.44", "0.3702", "0.1732", "62.90", "6.1407", second("71.65"), best("0.7112"))
tbody += row("HEVC","SILO","ICCV'25", "26.94", "0.3675", "0.1777", "60.17", "5.7922", "58.32", "0.4596")
tbody += row("HEVC","Moe-DiffIR","ECCV'24", second("30.44"), second("0.3472"), second("0.1526"), second("59.93"), second("5.0408"), "59.41", "0.5135")
tbody += row("HEVC","Ours","--", "28.93", best("0.3118"), best("0.1395"), best("49.52"), best("4.9164"), best("74.99"), second("0.6422"))
# C_PSNR
tbody += row("C_PSNR","SwinIR","ICCV'21", "31.33", "0.4012", "0.2386", "108.64", "8.0489", "54.80", "0.3717")
tbody += row("C_PSNR","PASD","ICCV'23", second("31.41"), "0.3549", "0.1968", "98.74", "6.1762", "67.97", "0.4750")
tbody += row("C_PSNR","DiffBIR","ECCV'24", "28.33", "0.3258", second("0.1601"), "65.86", "6.4165", best("75.67"), best("0.7839"))
tbody += row("C_PSNR","SILO","ICCV'25", "26.79", "0.3945", "0.2209", "85.72", "7.4365", "51.04", "0.3961")
tbody += row("C_PSNR","Moe-DiffIR","ECCV'24", best("32.00"), second("0.3126"), "0.1610", best("61.01"), second("5.5442"), "62.79", "0.5226")
tbody += row("C_PSNR","Ours","--", "28.88", best("0.3069"), best("0.1472"), second("61.53"), best("5.0523"), second("75.62"), second("0.7047"))
# C_SSIM
tbody += row("C_SSIM","SwinIR","ICCV'21", second("31.19"), "0.3876", "0.2275", "104.32", "7.7405", "54.54", "0.3906")
tbody += row("C_SSIM","PASD","ICCV'23", "31.11", "0.3311", "0.1753", "82.30", "5.2647", "68.92", "0.5033")
tbody += row("C_SSIM","DiffBIR","ECCV'24", "28.20", "0.3238", "0.1542", "57.85", "6.1586", best("75.93"), best("0.7897"))
tbody += row("C_SSIM","SILO","ICCV'25", "26.70", "0.3965", "0.2197", "85.32", "7.3315", "48.38", "0.3795")
tbody += row("C_SSIM","Moe-DiffIR","ECCV'24", best("31.50"), second("0.3041"), second("0.1534"), best("50.12"), second("5.2141"), "58.90", "0.4554")
tbody += row("C_SSIM","Ours","--", "29.10", best("0.3026"), best("0.1438"), second("55.81"), best("4.7695"), second("75.43"), second("0.6822"))
# JPEG-WEBP
tbody += row("JPEG-WEBP","SwinIR","ICCV'21", best("31.08"), "0.4207", "0.2441", "98.19", "8.4159", "51.18", "0.3434")
tbody += row("JPEG-WEBP","PASD","ICCV'23", "30.35", "0.4081", "0.1857", "74.43", "5.5501", second("64.76"), "0.4217")
tbody += row("JPEG-WEBP","DiffBIR","ECCV'24", "28.81", "0.4290", "0.2227", "82.12", "6.6159", "63.07", second("0.5424"))
tbody += row("JPEG-WEBP","SILO","ICCV'25", "27.32", second("0.3602"), "0.1756", second("55.46"), "5.8331", "59.22", "0.4534")
tbody += row("JPEG-WEBP","Moe-DiffIR","ECCV'24", second("30.93"), "0.3720", second("0.1754"), "69.87", best("4.8520"), "59.59", "0.4405")
tbody += row("JPEG-WEBP","Ours","--", "27.87", best("0.3492"), best("0.1620"), best("52.77"), second("5.1375"), best("68.16"), best("0.5573"))

table_html = f"""<section id="results-table" class="section">
  <div class="container">
    <h2>Quantitative Results</h2>
    <div class="table-wrap">
      <table>
        <caption>Arrows indicate directionality: ↑ higher is better; ↓ lower is better.</caption>
        <thead><tr><th class="center">Codec</th><th>Method</th><th>Venue</th><th class="center">PSNR ↑</th><th class="center">LPIPS ↓</th><th class="center">DISTS ↓</th><th class="center">FID ↓</th><th class="center">NIQE ↓</th><th class="center">MUSIQ ↑</th><th class="center">ClipIQA ↑</th></tr></thead>
        <tbody>{tbody}</tbody>
      </table>
    </div>
  </div>
</section>"""

# Results PDFs section with user's six files (paths under /pdf/)
pdfs = [
    "pdf/jpeg10_web1_225.pdf",
    "pdf/jpeg10_web1_258.pdf",
    "pdf/jpeg10_web1_265.pdf",
    "pdf/jpeg10_web1_294.pdf",
    "pdf/jpeg10_web1_297.pdf",
    "pdf/jpeg10_web1_298.pdf",
]
pdf_figs = []
for p in pdfs:
    name = os.path.basename(p)
    pdf_figs.append(f"""
    <figure class="card" style="margin-top:12px">
      <figcaption style="margin-bottom:6px;color:#4b5563">{name}</figcaption>
      <object class="pdf-embed small" data="{p}" type="application/pdf">
        <div class="pdf-fallback"><a href="{p}" target="_blank" rel="noopener">Open {name}</a></div>
      </object>
    </figure>""")

index = f"""<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{title}</title>
  <link rel="stylesheet" href="assets/css/site.css">
</head>
<body>
  <div class="topbar"><div class="container nav"><div class="brand">C-ReLIC</div>
    <nav><a href="#abstract">Abstract</a><a href="#results-table">Table</a><a href="#pdfs">Result PDFs</a><a href="#bibtex">BibTeX</a></nav></div></div>

  <main>
    <section id="abstract" class="section"><div class="container"><h2>Abstract</h2><div class="card"><p>{abstract_html}</p></div></div></section>

    {table_html}

    <section id="pdfs" class="section">
      <div class="container">
        <h2>Result PDFs</h2>
        <div class="card"><p>These are embedded as-is from the <code>/pdf/</code> folder. Replace with your actual files using the same names/paths.</p></div>
        {''.join(pdf_figs)}
      </div>
    </section>

    <section id="bibtex" class="section"><div class="container"><h2>BibTeX</h2>
      <div class="card"><pre>@article{{c-relic,
  title={{ {title} }},
  author={{ Alice and Bob and Carol and Dave }},
  journal={{ arXiv preprint arXiv:xxxx.xxxxx }},
  year={{ 2025 }}
}}</pre></div></div></section>
  </main>

  <footer class="footer"><div class="container">© <span id="y"></span> Your Name</div></footer>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
</body></html>"""

open(os.path.join(root, "index.html"), "w", encoding="utf-8").write(index)

# README
open(os.path.join(root, "README.md"), "w", encoding="utf-8").write(textwrap.dedent("""\
# C-ReLIC — LLaVA-style (English, PDFs only)

## What this includes
- English-only page with your title and abstract.
- A quantitative results table (HTML).
- A "Result PDFs" section that embeds the following files from `/pdf/`:
  - `pdf/jpeg10_web1_225.pdf`
  - `pdf/jpeg10_web1_258.pdf`
  - `pdf/jpeg10_web1_265.pdf`
  - `pdf/jpeg10_web1_294.pdf`
  - `pdf/jpeg10_web1_297.pdf`
  - `pdf/jpeg10_web1_298.pdf`

## How to use
1. Put your actual PDFs into the `pdf/` folder with the exact names above.
2. Upload everything to your GitHub repo root and enable GitHub Pages (Deploy from a branch → `main / (root)`).
3. Open your site.

Tip: If mobile browsers don’t render PDF inline, the page shows a fallback “Open PDF” link.
"""))

# Zip it
zip_path = "/mnt/data/c-relic-llava-style-pdf-en.zip"
with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as z:
    for basepath, _, files in os.walk(root):
        for name in files:
            full = os.path.join(basepath, name)
            arc = os.path.relpath(full, root)
            z.write(full, arcname=arc)

zip_path
